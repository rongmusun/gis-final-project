{
  "hash": "a13f108d81cd7a768b82168f60085b0a",
  "result": {
    "markdown": "---\ntitle: \"Evaluating the Effectiveness of NYC Subway Accessibility for Schools\"\nsubtitle: \"DSAN 6750 / PPOL 6805: GIS for Spatial Data Science\"\nauthors:\n  - name: Rongmu Sun\n    email: rs2264@georgetown.edu\n    affiliation: Georgetown University\n    corresponding: true\ntitle-block-banner: \"#E69F0095\"\ntitle-block-banner-color: \"black\"\nformat:\n  html:\n    embed-resources: true\n    theme: litera\n    code-fold: true\nprefer-html: true\nwarning: false\nmessage: false\n---\n\n\n## Introduction\n\nThe New York City subway system is one of the largest and most extensive public transit networks in the world, playing a crucial role in the daily lives of millions of residents and visitors. With over 400 stations and miles of track, the subway serves as a vital lifeline for transportation across the city. While the subway network is designed to connect people to key urban areas, its effectiveness in providing access to essential public facilities such as schools remains a critical question for urban planning and policy.\n\nThis project aims to evaluate the effectiveness of the NYC subway system in providing accessibility to schools. Schools are fundamental public facilities that require reliable and equitable access for students, teachers, and staff. By analyzing the spatial relationship between subway lines and schools, this study seeks to determine how well the subway network serves the educational needs of the city’s population.\n\nThe primary objective of this study is to assess the accessibility of NYC subway lines to schools by measuring the proportion of schools located within a walkable distance (0.5 miles) of a subway station. The study will also identify underserved areas and provide insights for improving transit accessibility to schools.\n\n## Hypothesis\n\n\"The NYC subway system is highly effective in providing access to schools, with a significant proportion of schools located within 0.5 miles of a subway line.\"\n\nNull Hypothesis (H0): There is no significant difference in accessibility to schools compared to a random distribution of subway lines. The observed coverage rate is due to random chance.\n\nAlternative Hypothesis (H1): The NYC subway system is designed to provide effective access to schools, resulting in a higher-than-random school coverage rate.\n\nThis hypothesis explicitly relates to second-order properties, as it evaluates the spatial relationships between two datasets:\n\nSubway lines (spatial features): Representing the transit infrastructure.\nSchools (spatial points): Representing educational facilities.\n\n## Exploratory Data Analysis (EDA)\n\nHere we plot the base GIS objects we're analyzing: the location of each **school points** (in red) and each **subway line** (in blue).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) |> suppressPackageStartupMessages()\nlibrary(sf) |> suppressPackageStartupMessages()\nlibrary(mapview) |> suppressPackageStartupMessages()\nlibrary(units) |> suppressPackageStartupMessages()\nlibrary(spdep) |> suppressPackageStartupMessages()\nlibrary(ggplot2) |> suppressPackageStartupMessages()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsubway_path <- \"Subway Lines NYC\"\nschool_path <- \"SchoolPoints_APS_2024_08_28\"\n\nsubway_lines <- st_read(file.path(subway_path, \"geo_export_175db71c-ebef-4b11-98b7-2e22d21d3e02.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `geo_export_175db71c-ebef-4b11-98b7-2e22d21d3e02' from data source `/Users/srongmu/Documents/6750/gis-final-project/Subway Lines NYC/geo_export_175db71c-ebef-4b11-98b7-2e22d21d3e02.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 742 features and 6 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: -74.03088 ymin: 40.57559 xmax: -73.75541 ymax: 40.90312\nGeodetic CRS:  WGS84(DD)\n```\n:::\n\n```{.r .cell-code}\nschool_points <- st_read(file.path(school_path, \"SchoolPoints_APS_2024_08_28.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `SchoolPoints_APS_2024_08_28' from data source \n  `/Users/srongmu/Documents/6750/gis-final-project/SchoolPoints_APS_2024_08_28/SchoolPoints_APS_2024_08_28.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1950 features and 7 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -8264799 ymin: 4940084 xmax: -8205206 ymax: 4998085\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n:::\n\n```{.r .cell-code}\nsubway_lines <- st_transform(subway_lines, crs = 4326)\nschool_points <- st_transform(school_points, crs = 4326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsubway_bbox <- st_bbox(subway_lines)\nprint(subway_bbox)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     xmin      ymin      xmax      ymax \n-74.03088  40.57559 -73.75541  40.90312 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nschool_points <- school_points %>%\n  filter(\n    st_coordinates(.)[, 1] >= subway_bbox[\"xmin\"] &  # Longitude >= min X\n    st_coordinates(.)[, 1] <= subway_bbox[\"xmax\"] &  # Longitude <= max X\n    st_coordinates(.)[, 2] >= subway_bbox[\"ymin\"] &  # Latitude >= min Y\n    st_coordinates(.)[, 2] <= subway_bbox[\"ymax\"]    # Latitude <= max Y\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = subway_lines, color = \"blue\", size = 0.5) +\n  geom_sf(data = school_points, color = \"red\", size = 1) +\n  labs(title = \"NYC Subway Lines and School Locations\",\n       caption = \"Data: NYC Open Data\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords <- st_coordinates(school_points)\n\nnb <- knearneigh(coords, k = 5)\nlistw <- nb2listw(knn2nb(nb))\n\nmoran <- moran.test(coords[, 1], listw)\nprint(moran)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tMoran I test under randomisation\n\ndata:  coords[, 1]  \nweights: listw    \n\nMoran I statistic standard deviate = 71.881, p-value < 2.2e-16\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n     0.9958242482     -0.0005555556      0.0001921442 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsubway_buffers <- st_buffer(subway_lines, dist = 804.67)\nsubway_buffers <- st_union(subway_buffers)\nsubway_buffers <- st_sf(geometry = subway_buffers)\n\nggplot() +\n  geom_sf(data = subway_buffers, fill = \"light blue\", alpha = 0.3) +\n  geom_sf(data = subway_lines, color = \"black\") +\n  geom_sf(data = school_points, color = \"red\", size = 1) +\n  labs(title = \"Subway Lines, Buffer Zones, and School Locations\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nschool_points <- st_make_valid(school_points)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Validate geometries in school_points\ninvalid_schools <- school_points[!st_is_valid(school_points), ]\ncat(\"Number of invalid geometries in school_points:\", nrow(invalid_schools), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of invalid geometries in school_points: 0 \n```\n:::\n\n```{.r .cell-code}\n# Fix invalid geometries in school_points\nschool_points <- st_make_valid(school_points)\n\n# Validate geometries in subway_buffers\ninvalid_buffers <- subway_buffers[!st_is_valid(subway_buffers), ]\ncat(\"Number of invalid geometries in subway_buffers:\", nrow(invalid_buffers), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of invalid geometries in subway_buffers: 1 \n```\n:::\n\n```{.r .cell-code}\n# Fix invalid geometries in subway_buffers\nsubway_buffers <- st_make_valid(subway_buffers)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nschools_within_buffer <- st_join(school_points, subway_buffers, join = st_intersects, left = FALSE)\n\ntotal_schools <- nrow(school_points)\nschools_in_buffer <- nrow(schools_within_buffer)\nschools_outside_buffer <- total_schools - schools_in_buffer\n\ncat(\"Total Schools:\", total_schools, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTotal Schools: 1801 \n```\n:::\n\n```{.r .cell-code}\ncat(\"Schools Within Buffer:\", schools_in_buffer, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSchools Within Buffer: 1472 \n```\n:::\n\n```{.r .cell-code}\ncat(\"Schools Outside Buffer:\", schools_outside_buffer, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSchools Outside Buffer: 329 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoverage_percentage <- (schools_in_buffer / total_schools) * 100\ncat(\"School Coverage Percentage:\", coverage_percentage, \"%\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSchool Coverage Percentage: 81.73237 %\n```\n:::\n\n```{.r .cell-code}\ndistances <- st_distance(school_points, subway_lines)\nmin_distances <- apply(distances, 1, min)\n\nschool_points$min_distance_to_subway <- as.numeric(min_distances)\n\naverage_distance <- mean(min_distances)\ncat(\"Average Distance to Subway (meters):\", average_distance, \"meters\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAverage Distance to Subway (meters): 582.5783 meters\n```\n:::\n\n```{.r .cell-code}\nggplot(data = as.data.frame(school_points)) +\n  geom_histogram(aes(x = min_distance_to_subway), bins = 30, fill = \"steelblue\") +\n  labs(title = \"Distribution of School Distances to Subway Lines\",\n       x = \"Minimum Distance (meters)\",\n       y = \"Count\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n## Hypothesis Testing (Regression)\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(spatstat)\n\n# Convert school points to a spatstat object\nschool_ppp <- as.ppp(st_coordinates(school_points), W = as.owin(st_bbox(school_points)))\n\n# Estimate the intensity function\nintensity <- density(school_ppp, sigma = 0.01)  # Adjust sigma for smoothing\n\n# Visualize the intensity function\nplot(intensity, main = \"Intensity Function of School Locations\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute the K function for observed school locations\nk_obs <- Kest(school_ppp)\n\n# Plot the observed K function\nplot(k_obs, main = \"Observed K Function for School Locations\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(6750)\n\n# Run 999 Monte Carlo simulations\nn_simulations <- 999\nk_sim <- envelope(school_ppp, Kest, nsim = n_simulations)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGenerating 999 simulations of CSR  ...\n1, 2, 3, ......10.........20.........30.........40.........50.........60..\n.......70.........80.........90.........100.........110.........120.........130\n.........140.........150.........160.........170.........180.........190........\n.200.........210.........220.........230.........240.........250.........260......\n...270.........280.........290.........300.........310.........320.........330....\n.....340.........350.........360.........370.........380.........390.........400..\n.......410.........420.........430.........440.........450.........460.........470\n.........480.........490.........500.........510.........520.........530........\n.540.........550.........560.........570.........580.........590.........600......\n...610.........620.........630.........640.........650.........660.........670....\n.....680.........690.........700.........710.........720.........730.........740..\n.......750.........760.........770.........780.........790.........800.........810\n.........820.........830.........840.........850.........860.........870........\n.880.........890.........900.........910.........920.........930.........940......\n...950.........960.........970.........980.........990........\n999.\n\nDone.\n```\n:::\n\n```{.r .cell-code}\n# Visualize the envelope of simulated K functions\nplot(k_sim, main = \"K Function with Monte Carlo Envelope\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Overlay observed K function with the simulated envelope\nplot(k_sim, main = \"Comparison of Observed and Simulated K Functions\")\nlines(k_obs, col = \"red\", lwd = 2)  # Add observed K function\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot the intensity of schools and subway lines\nlibrary(ggplot2)\n\nggplot() +\n  geom_sf(data = subway_lines, color = \"blue\", size = 0.5) +\n  geom_sf(data = school_points, aes(color = log(min_distance_to_subway)), size = 1) +\n  scale_color_viridis_c(option = \"plasma\", name = \"Log Distance (m)\") + # Apply a viridis color scale for better visualization\n  labs(\n    title = \"Spatial Distribution of Schools and Subway Lines\",\n    subtitle = \"Color represents log-transformed distance to the nearest subway line\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(raster)\n# Extract density values for each school\ndensity_raster <- raster(intensity)\nschool_points$density <- raster::extract(density_raster, st_coordinates(school_points))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate the correlation between school density and proximity to subway lines\ncorrelation <- cor(school_points$min_distance_to_subway, school_points$density, use = \"complete.obs\")\ncat(\"Correlation between school density and subway proximity:\", correlation, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCorrelation between school density and subway proximity: -0.3362262 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel <- lm(density ~ min_distance_to_subway, data = school_points)\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = density ~ min_distance_to_subway, data = school_points)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-49631 -20562  -5763  13446  87596 \n\nCoefficients:\n                        Estimate Std. Error t value Pr(>|t|)    \n(Intercept)            56319.059    785.273   71.72   <2e-16 ***\nmin_distance_to_subway   -12.019      0.794  -15.14   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 26920 on 1798 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.113,\tAdjusted R-squared:  0.1126 \nF-statistic: 229.2 on 1 and 1798 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Discussion\n\nObserved Pattern:\n\nThe clustering of schools is significant, particularly at smaller distances (r<0.05). This suggests that schools tend to be located close to one another more often than would be expected under random placement.\n\nThe clustering of schools could be related to urban planning policies, population density, or access to infrastructure (e.g., proximity to subway lines).\n\n\nRelationship:\n\nStatistical Significance\nBoth the intercept and slope are highly significant (p<2e−16).\nThe significant negative slope indicates that schools are more densely clustered closer to subway lines, supporting the Alternative Hypothesis (H₁).\n\nThis aligns with urban planning principles, where schools are often placed near transit hubs for accessibility.\n\nWhile the relationship is significant, the low R-squared suggests that factors beyond proximity to subway lines (e.g., population density, neighborhood infrastructure) also influence school clustering.\n## Conclusion\n\nBased on the regression results:\n\nWe reject the Null Hypothesis (H₀) in favor of the Alternative Hypothesis (H₁).\nThe NYC subway system significantly impacts school density, with schools clustering closer to subway lines.\nAlthough the R-squared value suggests additional factors influence school density, the relationship with subway proximity is strong and statistically significant.\n\nThe NYC subway system is effective in providing access to schools, as evidenced by the clustering of schools near subway lines.",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}